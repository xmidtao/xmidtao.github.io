"use strict";(self.webpackChunkagile_docs=self.webpackChunkagile_docs||[]).push([[6380],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(t),m=r,g=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return t?a.createElement(g,l(l({ref:n},p),{},{components:t})):a.createElement(g,l({ref:n},p))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=u;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var c=2;c<o;c++)l[c]=t[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},5510:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return u}});var a=t(3117),r=t(102),o=(t(7294),t(3905)),l=["components"],i={id:"installation",title:"\u5b89\u88c5",sidebar_label:"\u5b89\u88c5",slug:"/packages/installation"},s=void 0,c={unversionedId:"packages/installation",id:"packages/installation",title:"\u5b89\u88c5",description:"\u56e0\u4e3a\u8d44\u6e90\u95ee\u9898\uff0c\u6545\u76f4\u63a5\u5728 Mac \u672c\u5730\u8fdb\u884c\u73af\u5883\u642d\u5efa\uff0cNeon Database \u6e90\u7801\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u5b83\u63d0\u4f9b All In One \u7684\u811a\u672c\uff0c\u4e00\u952e\u6784\u5efa\uff0c\u6211\u5728\u4e24\u4e2a Mac(M1 \u548c\u56e0\u7279\u5c14) \u90fd\u5c1d\u8bd5\u8fc7\uff0c\u6ca1\u5931\u8d25\u8fc7\u3002",source:"@site/docs/packages/Installation.md",sourceDirName:"packages",slug:"/packages/installation",permalink:"/docs/packages/installation",editUrl:"https://github.com/xmidtao/documentation/tree/main/docs/packages/Installation.md",tags:[],version:"current",lastUpdatedAt:1690724780,formattedLastUpdatedAt:"7/30/2023",frontMatter:{id:"installation",title:"\u5b89\u88c5",sidebar_label:"\u5b89\u88c5",slug:"/packages/installation"},sidebar:"docs",previous:{title:"\u7b80\u4ecb",permalink:"/docs/packages"},next:{title:"Introduction",permalink:"/docs/core"}},p=[{value:"\u23f3 \u7f16\u8bd1\u5b89\u88c5",id:"-\u7f16\u8bd1\u5b89\u88c5",children:[{value:"\u6784\u5efa\u4e8e OSX",id:"\u6784\u5efa\u4e8e-osx",children:[],level:3},{value:"\u4f9d\u8d56\u5b89\u88c5\u63d0\u793a",id:"\u4f9d\u8d56\u5b89\u88c5\u63d0\u793a",children:[],level:3},{value:"\u8fd0\u884c Neon",id:"\u8fd0\u884c-neon",children:[],level:3}],level:2},{value:"\ud83e\udd13 TPCH",id:"-tpch",children:[],level:2},{value:"\ud83d\udc1e GDB/LLDB \u8c03\u8bd5",id:"-gdblldb-\u8c03\u8bd5",children:[],level:2},{value:"\ud83d\udcc1 \u6817\u5b50",id:"-\u6817\u5b50",children:[{value:"In \u67e5\u8be2",id:"in-\u67e5\u8be2",children:[],level:3},{value:"<code>=Any</code> \u67e5\u8be2",id:"any-\u67e5\u8be2",children:[],level:3},{value:"Exists \u67e5\u8be2",id:"exists-\u67e5\u8be2",children:[],level:3},{value:"\u5176\u4ed6",id:"\u5176\u4ed6",children:[],level:3}],level:2},{value:"\ud83d\udcc4 \u53c2\u8003",id:"-\u53c2\u8003",children:[],level:2}],d={toc:p};function u(e){var n=e.components,t=(0,r.Z)(e,l);return(0,o.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u56e0\u4e3a\u8d44\u6e90\u95ee\u9898\uff0c\u6545\u76f4\u63a5\u5728 Mac \u672c\u5730\u8fdb\u884c\u73af\u5883\u642d\u5efa\uff0cNeon Database \u6e90\u7801\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u5b83\u63d0\u4f9b All In One \u7684\u811a\u672c\uff0c\u4e00\u952e\u6784\u5efa\uff0c\u6211\u5728\u4e24\u4e2a Mac(M1 \u548c\u56e0\u7279\u5c14) \u90fd\u5c1d\u8bd5\u8fc7\uff0c\u6ca1\u5931\u8d25\u8fc7\u3002"),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},"\u2139\ufe0f"),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"\u52a0\u901f\u7f16\u8bd1\uff0c\u62d2\u7edd\u7b49\u5f85\uff0c\u5efa\u8bae\u6709\u6761\u4ef6\u540c\u5b66\uff0c\u51c6\u5907\u9ad8\u914d\u4e00\u70b9\u7684\u7b14\u8bb0\u672c\u7535\u8111\u6216\u53f0\u5f0f\u673a\uff0c\u4e00\u822c\u9996\u9009\u9ad8\u914d MacBook Pro \u6216\u7ec4\u88c5\u9ad8\u914d\u53f0\u5f0f\u673a\u4e5f\u53ef\uff0c\u9009\u4e00\u4e2a Linux/Unix \u64cd\u4f5c\u7cfb\u7edf\u914d\u5408\u98df\u7528\u3002"))),(0,o.kt)("h2",{id:"-\u7f16\u8bd1\u5b89\u88c5"},"\u23f3 \u7f16\u8bd1\u5b89\u88c5"),(0,o.kt)("p",null,"\u64cd\u4f5c\u7cfb\u7edf\uff1a",(0,o.kt)("inlineCode",{parentName:"p"},"Macos12.6 on x86_64")),(0,o.kt)("p",null,"\u786c\u4ef6\u73af\u5883\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Processor Name: Dual-Core Intel Core i5\nProcessor Speed:  2.9 GHz\nNumber of Processors: 1\nTotal Number of Cores:    2\nL2 Cache (per Core):  256 KB\nL3 Cache: 3 MB\nMemory:   8 GB\n")),(0,o.kt)("p",null,"OSX \u4e00\u952e\u811a\u672c\u7f16\u8bd1\uff0c\u5b83\u4f1a\u81ea\u52a8\u5904\u7406\u4f9d\u8d56\u7b49\u95ee\u9898\uff0c\u9996\u6b21\u7f16\u8bd1\u9700\u8981\u4e9b\u65f6\u95f4\u3002"),(0,o.kt)("h3",{id:"\u6784\u5efa\u4e8e-osx"},"\u6784\u5efa\u4e8e OSX"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u6784\u5efa neon \u548c patched postgres")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'# Note: The path to the neon sources can not contain a space.\n\ngit clone --recursive https://github.com/neondatabase/neon.git\ncd neon\n\n# The preferred and default is to make a debug build. This will create a\n# demonstrably slower build than a release build. For a release build,\n# use "BUILD_TYPE=release make -j`sysctl -n hw.logicalcpu` -s"\n# Remove -s for the verbose build log\n\nmake -j`sysctl -n hw.logicalcpu` -s\n')),(0,o.kt)("h3",{id:"\u4f9d\u8d56\u5b89\u88c5\u63d0\u793a"},"\u4f9d\u8d56\u5b89\u88c5\u63d0\u793a"),(0,o.kt)("p",null,"To run the ",(0,o.kt)("inlineCode",{parentName:"p"},"psql")," client, install the ",(0,o.kt)("inlineCode",{parentName:"p"},"postgresql-client")," package or modify ",(0,o.kt)("inlineCode",{parentName:"p"},"PATH")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"LD_LIBRARY_PATH")," to include ",(0,o.kt)("inlineCode",{parentName:"p"},"pg_install/bin")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"pg_install/lib"),", respectively."),(0,o.kt)("p",null,"To run the integration tests or Python scripts (not required to use the code), install\nPython (3.9 or higher), and install python3 packages using ",(0,o.kt)("inlineCode",{parentName:"p"},"./scripts/pysync")," (requires ",(0,o.kt)("a",{parentName:"p",href:"https://python-poetry.org/"},"poetry>=1.3"),") in the project directory."),(0,o.kt)("h3",{id:"\u8fd0\u884c-neon"},"\u8fd0\u884c Neon"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Start pageserver and postgres on top of it (should be called from repo root):")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"# Create repository in .neon with proper paths to binaries and data\n# Later that would be responsibility of a package install script\n> cargo neon init\nInitializing pageserver node 1 at '127.0.0.1:64000' in \".neon\"\n\n# start pageserver, safekeeper, and broker for their intercommunication\n> cargo neon start\nStarting neon broker at 127.0.0.1:50051.\nstorage_broker started, pid: 2918372\nStarting pageserver node 1 at '127.0.0.1:64000' in \".neon\".\npageserver started, pid: 2918386\nStarting safekeeper at '127.0.0.1:5454' in '.neon/safekeepers/sk1'.\nsafekeeper 1 started, pid: 2918437\n\n# create initial tenant and use it as a default for every future neon_local invocation\n> cargo neon tenant create --set-default\ntenant 9ef87a5bf0d92544f6fafeeb3239695c successfully created on the pageserver\nCreated an initial timeline 'de200bd42b49cc1814412c7e592dd6e9' at Lsn 0/16B5A50 for tenant: 9ef87a5bf0d92544f6fafeeb3239695c\nSetting tenant 9ef87a5bf0d92544f6fafeeb3239695c as a default one\n\n# start postgres compute node\n> cargo neon endpoint start main\nStarting new endpoint main (PostgreSQL v14) on timeline de200bd42b49cc1814412c7e592dd6e9 ...\nStarting postgres at 'postgresql://cloud_admin@127.0.0.1:55432/postgres'\n\n# check list of running postgres instances\n> cargo neon endpoint list\n ENDPOINT  ADDRESS          TIMELINE                          BRANCH NAME  LSN        STATUS\n main      127.0.0.1:55432  de200bd42b49cc1814412c7e592dd6e9  main         0/16B5BA8  running\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Now, it is possible to connect to postgres and run some queries:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"> psql -p55432 -h 127.0.0.1 -U cloud_admin postgres\npostgres=# CREATE TABLE t(key int primary key, value text);\nCREATE TABLE\npostgres=# insert into t values(1,1);\nINSERT 0 1\npostgres=# select * from t;\n key | value\n-----+-------\n   1 | 1\n(1 row)\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"And create branches and run postgres on them:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"# create branch named migration_check\n> cargo neon timeline branch --branch-name migration_check\nCreated timeline 'b3b863fa45fa9e57e615f9f2d944e601' at Lsn 0/16F9A00 for tenant: 9ef87a5bf0d92544f6fafeeb3239695c. Ancestor timeline: 'main'\n\n# check branches tree\n> cargo neon timeline list\n(L) main [de200bd42b49cc1814412c7e592dd6e9]\n(L) \u2517\u2501 @0/16F9A00: migration_check [b3b863fa45fa9e57e615f9f2d944e601]\n\n# start postgres on that branch\n> cargo neon endpoint start migration_check --branch-name migration_check\nStarting new endpoint migration_check (PostgreSQL v14) on timeline b3b863fa45fa9e57e615f9f2d944e601 ...\nStarting postgres at 'postgresql://cloud_admin@127.0.0.1:55434/postgres'\n\n# check the new list of running postgres instances\n> cargo neon endpoint list\n ENDPOINT         ADDRESS          TIMELINE                          BRANCH NAME      LSN        STATUS\n main             127.0.0.1:55432  de200bd42b49cc1814412c7e592dd6e9  main             0/16F9A38  running\n migration_check  127.0.0.1:55434  b3b863fa45fa9e57e615f9f2d944e601  migration_check  0/16F9A70  running\n\n# this new postgres instance will have all the data from 'main' postgres,\n# but all modifications would not affect data in original postgres\n> psql -p55434 -h 127.0.0.1 -U cloud_admin postgres\npostgres=# select * from t;\n key | value\n-----+-------\n   1 | 1\n(1 row)\n\npostgres=# insert into t values(2,2);\nINSERT 0 1\n\n# check that the new change doesn't affect the 'main' postgres\n> psql -p55432 -h 127.0.0.1 -U cloud_admin postgres\npostgres=# select * from t;\n key | value\n-----+-------\n   1 | 1\n(1 row)\n")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"If you want to run tests afterward (see below), you must stop all the running of the pageserver, safekeeper, and postgres instances\nyou have just started. You can terminate them all with one command:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"> cargo neon stop\n")),(0,o.kt)("h2",{id:"-tpch"},"\ud83e\udd13 TPCH"),(0,o.kt)("p",null,"Debug \u65b9\u4fbf\u7814\u7a76\u6267\u884c\u8ba1\u5212\u4ee5\u53ca\u590d\u6742 SQL \u7684\u5904\u7406\u6d41\u7a0b\uff0c\u76f4\u63a5\u5728 MYSQL \u4e2d\u5229\u7528 TPCH \u5de5\u5177\uff0c\u751f\u6210\u51e0\u5f20\u8868\uff0c\u5229\u7528 TPCH \u63d0\u4f9b\u7684 SQL \u6267\u884c\u7814\u7a76 SQL \u4f18\u5316\u5668\u7b49\u3002"),(0,o.kt)("p",null,"\u8bf7\u53c2\u8003 ",(0,o.kt)("a",{parentName:"p",href:"../mysql/basic/installation#-tpch"},"MySQL \u5b89\u88c5"),"\uff0c\u81ea\u884c\u51c6\u5907 PG TPCH \u5e93\u548c\u8868\u6570\u636e\u3002"),(0,o.kt)("h2",{id:"-gdblldb-\u8c03\u8bd5"},"\ud83d\udc1e GDB/LLDB \u8c03\u8bd5"),(0,o.kt)("p",null,"\u6211\u4f7f\u7528\u7684\u662f MAC \u7cfb\u7edf\uff0c\u4e00\u822c\u90fd\u4f7f\u7528 LLDB \u8fdb\u884c\u8c03\u8bd5\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ lldb\n(lldb) b list\nBreakpoint 1: no locations (pending).\n\n(lldb) attach -p 38593\n\n(lldb) b exec_simple_query # pg \u6267\u884c sql \u5165\u53e3\u51fd\u6570\n\n(lldb) bt\n")),(0,o.kt)("p",null,"\u5982\u679c\u5bf9 PG \u6e90\u7801\u4e0d\u719f\u6089\uff0c\u5efa\u8bae\u4ece PG \u7684 SQL \u89e3\u6790\u5165\u53e3\u5f00\u59cb\u8fdb\u884c Debug\uff0c\u7ed3\u5408\u6e90\u7801\u89c2\u5bdf\u8c03\u7528\u94fe\u8def\uff0c\u4e5f\u53ef\u76f4\u63a5\u7528 Clion\u3001VSCode \u7b49\u5de5\u5177\u76f4\u63a5\u8fdb\u884c Debug\uff0c\u7f51\u4e0a\u6559\u7a0b\u5f88\u591a\u5c31\u4e0d\u5728\u8d58\u8ff0\u3002"),(0,o.kt)("h2",{id:"-\u6817\u5b50"},"\ud83d\udcc1 \u6817\u5b50"),(0,o.kt)("p",null,"\u5047\u8bbe\u6211\u4eec\u60f3\u7814\u7a76\u4e00\u4e0b PG \u5bf9\u4e8e ",(0,o.kt)("inlineCode",{parentName:"p"},"In/=Any/Exists")," \u67e5\u8be2\u6267\u884c\u8ba1\u5212\u4f1a\u5982\u4f55\u6539\u5199\u3002"),(0,o.kt)("h3",{id:"in-\u67e5\u8be2"},"In \u67e5\u8be2"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"\n\n")),(0,o.kt)("h3",{id:"any-\u67e5\u8be2"},(0,o.kt)("inlineCode",{parentName:"h3"},"=Any")," \u67e5\u8be2"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"")),(0,o.kt)("h3",{id:"exists-\u67e5\u8be2"},"Exists \u67e5\u8be2"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"")),(0,o.kt)("h3",{id:"\u5176\u4ed6"},"\u5176\u4ed6"),(0,o.kt)("p",null,"1=0\uff0c\u4f18\u5316\u540e\u76f4\u63a5\u8fd4\u56de\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"")),(0,o.kt)("h2",{id:"-\u53c2\u8003"},"\ud83d\udcc4 \u53c2\u8003"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://lldb.llvm.org/use/tutorial.html"},"LLDB \u4f7f\u7528")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://gist.github.com/patshaughnessy/70519495343412504686"},"How to Debug Postgres using LLDB on a Mac"))))}u.isMDXComponent=!0}}]);